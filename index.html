<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Climate Data Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="container my-4">
  <div class="mb-4">
    <h1>Climate Data Dashboard</h1>
    <div class="row">
      <div class="col-md-3">
        <select id="locationSelect" class="form-select">
          <option value="Gander_daily_data.csv">Gander</option>
          <option value="StJohns_daily_data.csv">St. John's</option>
          <!-- more locations here -->
        </select>
      </div>
      <div class="col-md-3">
        <select id="analysisType" class="form-select">
          <option value="max">Max Temperature</option>
          <option value="min">Min Temperature</option>
          <option value="above">Days Above Temp</option>
          <option value="custom">Custom Query</option>
        </select>
      </div>
      <div class="col-md-2">
        <input id="yearInput" placeholder="Year" class="form-control">
      </div>
      <div class="col-md-2">
        <input id="thresholdInput" placeholder="Threshold" class="form-control d-none">
      </div>
      <div class="col-md-2">
        <button id="analyzeBtn" class="btn btn-primary w-100">Analyze</button>
      </div>
    </div>
  </div>
  <div>
    <h3>Result</h3>
    <div id="resultArea"></div>
    <canvas id="resultChart"></canvas>
  </div>
</div>

<script>
let climateData = [];
let chart = null;

// --- Fetch and parse the selected file ---
function loadLocation(filename) {
  Papa.parse(filename, {
    header: true,
    download: true,
    complete: function(results) {
      climateData = results.data;
      document.getElementById('resultArea').textContent = "Data loaded (" + climateData.length + " rows)";
    }
  });
}

document.getElementById('locationSelect').addEventListener('change', function() {
  loadLocation(this.value);
});

// Toggle threshold visibility based on analysis
document.getElementById('analysisType').addEventListener('change', function() {
  document.getElementById('thresholdInput').classList.toggle('d-none', this.value !== 'above');
});

// --- Handle analysis ---
document.getElementById('analyzeBtn').addEventListener('click', function() {
  const analysis = document.getElementById('analysisType').value;
  const year = document.getElementById('yearInput').value;
  const threshold = parseFloat(document.getElementById('thresholdInput').value);

  // Example: Max value for selected year
  if (analysis === 'max') {
    let filtered = climateData;
    if (year) filtered = filtered.filter(row => row["Date/Time"].startsWith(year));
    let max = null, maxRow = null;
    filtered.forEach(row => {
      let v = parseFloat(row["Max Temp (째C)"]);
      if (!isNaN(v) && (max === null || v > max)) { max = v; maxRow = row; }
    });
    document.getElementById('resultArea').textContent = maxRow ? `Max Temp: ${max}째C on ${maxRow["Date/Time"]}` : "No data";
  }

  // Example: Days Above Threshold
  else if (analysis === 'above') {
    let filtered = climateData;
    if (year) filtered = filtered.filter(row => row["Date/Time"].startsWith(year));
    let count = 0;
    filtered.forEach(row => {
      let v = parseFloat(row["Max Temp (째C)"]);
      if (!isNaN(v) && v >= threshold) count++;
    });
    document.getElementById('resultArea').textContent = `Days above ${threshold}째C: ${count}`;
  }

});

// Auto-load first location
window.onload = ()=>{ loadLocation(document.getElementById('locationSelect').value); }
</script>
</body>
</html>
